<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin â€¢ Just Click by Sherry</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        mint: { 50: '#f2fbf7', 100: '#e6f7ef', 200: '#c9efdf', 300: '#a5e3cb', 400: '#76d2b1', 500: '#4ab997', 600: '#359b80' },
                        plum: { 500: '#6b2e63', 600: '#5a2753' }
                    },
                    fontFamily: {
                        body: ['"Plus Jakarta Sans"', 'ui-sans-serif', 'system-ui', 'Segoe UI', 'Roboto'],
                        display: ['"Plus Jakarta Sans"', 'ui-sans-serif', 'system-ui', 'Segoe UI', 'Roboto']
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-white text-slate-800 font-body">
    <header class="sticky top-0 z-40 bg-white/80 backdrop-blur border-b border-slate-100">
        <div class="max-w-6xl mx-auto px-4 h-16 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-9 h-9 rounded-xl bg-gradient-to-br from-mint-200 to-mint-400 flex items-center justify-center">
                    <span class="text-plum-600 text-xl">âŒ‚</span>
                </div>
                <div class="leading-tight">
                    <h1 class="text-lg font-semibold tracking-tight">Admin Dashboard</h1>
                    <p class="text-xs text-slate-500 -mt-0.5">Just Click by Sherry</p>
                </div>
            </div>
            <div class="flex items-center gap-3">
                <span class="inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-amber-50 text-amber-700 ring-1 ring-amber-200">Admin Mode</span>
                <a href="./index.html" class="text-sm text-plum-600 hover:underline">Customer View</a>
                <button id="goToStartBtn" class="rounded-full px-4 py-2 bg-plum-500 text-white hover:bg-plum-600 transition text-sm">Logout</button>
            </div>
        </div>
    </header>

    <main class="max-w-6xl mx-auto px-4 py-8">
        <div class="flex items-center gap-3 mb-6">
            <button id="tabOrders" class="rounded-full px-4 py-2 bg-plum-500 text-white hover:bg-plum-600 transition">Orders</button>
            <button id="tabProducts" class="rounded-full px-4 py-2 ring-1 ring-slate-200 hover:ring-plum-500 hover:text-plum-600 transition">Products</button>
        </div>

        <!-- Orders Panel -->
        <section id="panelOrders" class="block">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-2xl font-semibold flex items-center gap-2">
                    <span class="inline-block w-5 h-5">ðŸ§¾</span> Orders
                </h2>
                <div class="flex flex-wrap gap-2 items-center">
                    <input id="searchInput" class="px-3 py-2 rounded-full ring-1 ring-slate-200 text-sm focus:outline-none focus:ring-plum-500" placeholder="Search id or item...">
                    <input id="dateFrom" type="date" class="px-3 py-2 rounded-full ring-1 ring-slate-200 text-sm focus:outline-none focus:ring-plum-500">
                    <input id="dateTo" type="date" class="px-3 py-2 rounded-full ring-1 ring-slate-200 text-sm focus:outline-none focus:ring-plum-500">
                    <select id="pageSize" class="px-3 py-2 rounded-full ring-1 ring-slate-200 text-sm focus:outline-none focus:ring-plum-500">
                        <option value="6">6</option>
                        <option value="12">12</option>
                        <option value="24">24</option>
                    </select>
                    <button id="refreshOrders" class="text-sm rounded-full px-4 py-2 ring-1 ring-slate-200 hover:ring-plum-500 hover:text-plum-600 transition">Refresh</button>
                </div>
            </div>
            <div id="orders" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
            <div class="mt-4 flex items-center justify-between">
                <button id="prevPage" class="rounded-full px-4 py-2 ring-1 ring-slate-200 hover:ring-plum-500 transition">Prev</button>
                <div id="pageInfo" class="text-sm text-slate-600">Page 1</div>
                <button id="nextPage" class="rounded-full px-4 py-2 ring-1 ring-slate-200 hover:ring-plum-500 transition">Next</button>
            </div>
        </section>

        <!-- Products Panel -->
        <section id="panelProducts" class="hidden">
            
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-2xl font-semibold">Products</h2>
                <button id="addProductBtn" class="rounded-full px-4 py-2 bg-plum-500 text-white hover:bg-plum-600 transition">Add Product</button>
            </div>
            <div id="productsList" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
        </section>
    </main>

    <script>
        window.FIREBASE_CONFIG = {
          apiKey: "AIzaSyBs74HoIeuFoXE0G_mdD2eNBDsucuAEQCA",
          authDomain: "justclickshop-8081b.firebaseapp.com",
          projectId: "justclickshop-8081b",
          storageBucket: "justclickshop-8081b.firebasestorage.app",
          messagingSenderId: "623998776057",
          appId: "1:623998776057:web:f488332b7b49bbc3f5a828",
          measurementId: "G-DTDJ1CGMWB"
        };
    </script>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js';
        import { getFirestore, collection, query, orderBy, onSnapshot, addDoc, deleteDoc, updateDoc, doc, getDocs } from 'https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js';

        const app = initializeApp(window.FIREBASE_CONFIG);
        const db = getFirestore(app);

        // Tabs
        const tabOrders = document.getElementById('tabOrders');
        const tabProducts = document.getElementById('tabProducts');
        const panelOrders = document.getElementById('panelOrders');
        const panelProducts = document.getElementById('panelProducts');
        function showPanel(which){
            const showOrders = which === 'orders';
            panelOrders.classList.toggle('hidden', !showOrders);
            panelProducts.classList.toggle('hidden', showOrders);
            tabOrders.classList.toggle('bg-plum-500', showOrders);
            tabOrders.classList.toggle('text-white', showOrders);
            tabOrders.classList.toggle('ring-1', !showOrders);
            tabOrders.classList.toggle('ring-slate-200', !showOrders);
            tabProducts.classList.toggle('bg-plum-500', !showOrders);
            tabProducts.classList.toggle('text-white', !showOrders);
            tabProducts.classList.toggle('ring-1', showOrders);
            tabProducts.classList.toggle('ring-slate-200', showOrders);
        }
        tabOrders.addEventListener('click', ()=>showPanel('orders'));
        tabProducts.addEventListener('click', ()=>showPanel('products'));

        // Orders realtime list + actions
        const ordersEl = document.getElementById('orders');
        const ordersRef = collection(db, 'orders');
        const ordersQuery = query(ordersRef, orderBy('createdAt', 'desc'));
        let allOrders = [];
        let curPage = 1;
        function applyFilters() {
            const q = (document.getElementById('searchInput').value || '').toLowerCase();
            const from = document.getElementById('dateFrom').value ? new Date(document.getElementById('dateFrom').value) : null;
            const to = document.getElementById('dateTo').value ? new Date(document.getElementById('dateTo').value + 'T23:59:59') : null;
            let filtered = allOrders.filter(o => {
                 const customerName = (o.customer?.name || '');
        const text = (o.id + ' ' + customerName + ' ' + (o.items || []).map(i=>i.name).join(' ')).toLowerCase();
                if (q && !text.includes(q)) return false;
                if (from && o.createdAt && o.createdAt.toDate && o.createdAt.toDate() < from) return false;
                if (to && o.createdAt && o.createdAt.toDate && o.createdAt.toDate() > to) return false;
                return true;
            });
            const size = parseInt(document.getElementById('pageSize').value || '6', 10);
            const totalPages = Math.max(1, Math.ceil(filtered.length / size));
            if (curPage > totalPages) curPage = totalPages;
            const start = (curPage - 1) * size;
            const page = filtered.slice(start, start + size);
            renderOrders(page);
            document.getElementById('pageInfo').textContent = `Page ${curPage} / ${totalPages}`;
        }

        function statusBadge(status){
            const s = (status || 'pending').toLowerCase();
            if (s === 'completed' || s === 'complete') return '<span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-50 text-green-700 ring-1 ring-green-200">Completed</span>';
            if (s === 'processing' || s === 'processed') return '<span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-50 text-blue-700 ring-1 ring-blue-200">Processing</span>';
            return '<span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-amber-50 text-amber-700 ring-1 ring-amber-200">Pending</span>';
        }

        function renderOrders(list) {
            ordersEl.innerHTML = '';
            list.forEach(d => {
                const data = d;
                const items = (data.items || []).map(i => `${i.name} Ã— ${i.quantity} â€” â‚±${Number(i.price).toFixed(2)}`).join('<br>');
                const total = Number(data.total || 0).toFixed(2);
                const time = data.createdAt?.toDate ? data.createdAt.toDate().toLocaleString() : '';
                const badge = statusBadge(data.status);
                const customer = data.customer || {};
                const card = document.createElement('div');
                card.className = 'p-5 rounded-2xl ring-1 ring-slate-100 shadow-sm bg-white';
                card.innerHTML = `
                    <div class="flex items-start justify-between gap-4">
                        <div>
                            <div class="text-sm text-slate-500">Order ID</div>
                            <div class="font-mono text-sm">${d.id}</div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm text-slate-500">Total</div>
                            <div class="font-semibold">â‚±${total}</div>
                        </div>
                    </div>
                    <div class="mt-3 flex items-center justify-between">
                        <div class="text-xs text-slate-500">${time}</div>
                        <div>${badge}</div>
                    </div>
                    ${(customer.name || customer.phone || customer.address || customer.facebook) ? `
                    <div class="mt-4 rounded-xl bg-slate-50 p-3 text-sm">
                        <div class="font-medium mb-1">Customer</div>
                        ${customer.name ? `<div><span class=\"text-slate-500\">Name:</span> ${customer.name}</div>` : ''}
                        ${customer.phone ? `<div><span class=\"text-slate-500\">Phone:</span> ${customer.phone}</div>` : ''}
                        ${customer.address ? `<div><span class=\"text-slate-500\">Address:</span> ${customer.address}</div>` : ''}
                        ${customer.facebook ? `<div><span class=\"text-slate-500\">Facebook:</span> ${customer.facebook}</div>` : ''}
                    </div>` : ''}
                    <div class="mt-4 text-sm">${items || 'No items'}</div>
                    <div class="mt-4 flex gap-2">
                        <button class="updateOrder rounded-full px-3 py-1 ring-1 ring-slate-200 hover:ring-plum-500">Mark Processed</button>
                        <button class="deleteOrder text-red-600 rounded-full px-3 py-1 ring-1 ring-red-200 hover:bg-red-50">Delete</button>
                    </div>`;
                card.querySelector('.deleteOrder').addEventListener('click', async () => {
                    const ok = confirm('Delete this order permanently?');
                    if (!ok) return;
                    await deleteDoc(doc(db, 'orders', d.id));
                });
                card.querySelector('.updateOrder').addEventListener('click', async () => {
                    await updateDoc(doc(db, 'orders', d.id), { status: 'processed' });
                });
                ordersEl.appendChild(card);
            });
        }

        onSnapshot(ordersQuery, (snap) => {
            allOrders = [];
            snap.forEach(docSnap => allOrders.push({ id: docSnap.id, ...docSnap.data() }));
            curPage = 1;
            applyFilters();
        });

        document.getElementById('searchInput').addEventListener('input', () => { curPage = 1; applyFilters(); });
        document.getElementById('dateFrom').addEventListener('change', () => { curPage = 1; applyFilters(); });
        document.getElementById('dateTo').addEventListener('change', () => { curPage = 1; applyFilters(); });
        document.getElementById('pageSize').addEventListener('change', () => { curPage = 1; applyFilters(); });
        document.getElementById('prevPage').addEventListener('click', () => { if (curPage > 1) { curPage--; applyFilters(); } });
        document.getElementById('nextPage').addEventListener('click', () => { curPage++; applyFilters(); });

        // Products CRUD
        const productsRef = collection(db, 'products');
        const productsList = document.getElementById('productsList');
        async function renderProductsAdmin(){
            const snap = await getDocs(productsRef);
            productsList.innerHTML = '';
            snap.forEach(d => {
                const p = d.data();
                const card = document.createElement('div');
                card.className = 'p-5 rounded-2xl ring-1 ring-slate-100 shadow-sm flex gap-4 bg-white';
                 card.innerHTML = `
                     <img src="${p.image || 'https://placehold.co/120x90'}" class="w-24 h-20 rounded-lg object-cover"/>
                     <div class="flex-1">
                         <div class="font-medium">${p.name}</div>
                         <div class="text-sm text-slate-500">${p.category || ''}</div>
                         <div class="mt-1 font-semibold">â‚±${Number(p.price||0).toFixed(2)}</div>
                         <div class="mt-2 flex items-center gap-2">
                             <span class="text-sm font-medium ${Number(p.stock || 0) > 0 ? 'text-green-600' : 'text-red-600'}">
                                 Stock: ${Number(p.stock || 0)}
                             </span>
                             ${Number(p.stock || 0) === 0 ? '<span class="text-xs bg-red-100 text-red-700 px-2 py-1 rounded-full">Out of Stock</span>' : ''}
                         </div>
                         <div class="mt-3 flex flex-wrap gap-2">
                             <button class="edit rounded-full px-3 py-1 ring-1 ring-slate-200 hover:ring-plum-500">Edit</button>
                             <button class="remove text-red-600 rounded-full px-3 py-1 ring-1 ring-red-200 hover:bg-red-50">Delete</button>
                         </div>
                     </div>`;
                card.querySelector('.remove').addEventListener('click', async ()=>{
                    const ok = confirm('Delete this product permanently?');
                    if (!ok) return;
                    await deleteDoc(doc(db, 'products', d.id));
                    renderProductsAdmin();
                });
                card.querySelector('.edit').addEventListener('click', ()=> openProductModal({ id: d.id, ...p }));
                productsList.appendChild(card);
            });
        }

        // Add/Edit modal
        const modalHtml = document.createElement('div');
        modalHtml.innerHTML = `
        <div id="productModal" class="fixed inset-0 hidden items-center justify-center bg-black/30">
  <div class="bg-white rounded-2xl p-6 w-[90%] max-w-md shadow-xl">
    <h3 class="text-lg font-semibold" id="pmTitle">Add Product</h3>
     <div class="grid gap-3 mt-3">
       <input id="pmName" class="px-4 py-3 rounded-xl ring-1 ring-slate-200 focus:outline-none focus:ring-plum-500" placeholder="Name">
       <input id="pmPrice" type="number" step="0.01" class="px-4 py-3 rounded-xl ring-1 ring-slate-200 focus:outline-none focus:ring-plum-500" placeholder="Price">
       <input id="pmCategory" class="px-4 py-3 rounded-xl ring-1 ring-slate-200 focus:outline-none focus:ring-plum-500" placeholder="Category (clothes/lip-tint/dress/full/top/perfume/accessory/pants/package/sweater)">
       <input id="pmStock" type="number" min="0" class="px-4 py-3 rounded-xl ring-1 ring-slate-200 focus:outline-none focus:ring-plum-500" placeholder="Stock Quantity">
       <input id="pmImage" class="px-4 py-3 rounded-xl ring-1 ring-slate-200 focus:outline-none focus:ring-plum-500" placeholder="Image URL">
     </div>
    <div class="mt-4 flex gap-2 justify-end">
      <button id="pmCancel" class="px-4 py-2 rounded-full ring-1 ring-slate-200">Cancel</button>
      <button id="pmSave" class="px-5 py-2 rounded-full bg-plum-500 text-white hover:bg-plum-600">Save</button>
    </div>
  </div>
</div>`;
        document.body.appendChild(modalHtml);
        const productModal = document.getElementById('productModal');
         function openProductModal(product){
             productModal.classList.remove('hidden');
             productModal.classList.add('flex');
             document.getElementById('pmTitle').textContent = product?.id ? 'Edit Product' : 'Add Product';
             document.getElementById('pmName').value = product?.name || '';
             document.getElementById('pmPrice').value = product?.price || '';
             document.getElementById('pmCategory').value = product?.category || '';
             document.getElementById('pmStock').value = product?.stock || '';
             document.getElementById('pmImage').value = product?.image || '';
             document.getElementById('pmSave').onclick = async () => {
                 const payload = {
                     name: document.getElementById('pmName').value.trim(),
                     price: parseFloat(document.getElementById('pmPrice').value || '0'),
                     category: document.getElementById('pmCategory').value.trim(),
                     stock: parseInt(document.getElementById('pmStock').value || '0'),
                     image: document.getElementById('pmImage').value.trim()
                 };
                 if (!payload.name) { alert('Name is required'); return; }
                 if (payload.stock < 0) { alert('Stock quantity cannot be negative'); return; }
                 try {
                     if (product?.id) {
                         await updateDoc(doc(db, 'products', product.id), payload);
                     } else {
                         await addDoc(productsRef, payload);
                     }
                     closeProductModal();
                     await renderProductsAdmin();
                     showPanel('products');
                 } catch (e) {
                     console.error(e);
                     alert('Failed to save product: ' + (e.message || e));
                 }
             };
         }
        function closeProductModal(){
            productModal.classList.add('hidden');
            productModal.classList.remove('flex');
        }
        document.getElementById('pmCancel')?.addEventListener('click', closeProductModal);
        document.getElementById('addProductBtn').addEventListener('click', ()=> openProductModal(null));
        document.getElementById('refreshOrders').addEventListener('click', ()=>{});

        // Initial renders
        renderProductsAdmin();

        document.getElementById('goToStartBtn').addEventListener('click', function() {
            const ok = confirm('Are you sure you want to logout of admin mode?');
            if (!ok) return;
            try { localStorage.removeItem('jcws_admin'); } catch {}
            window.location.href = './start.html';
        });
    </script>
</body>
<script>
    // Ensure admin mode is active whenever the admin dashboard is open (per-origin)
    (function(){ try { localStorage.setItem('jcws_admin','1'); } catch(e) {} })();
</script>
</html>
